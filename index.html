<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cotizador Express</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root { --p: #1a73e8; --r: #d93025; --g: #34a853; --o: #ff9800; --l: #f8f9fa; }
    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Google Sans', sans-serif; }
    body { background:#f5f5f5; color:#202124; font-size:14px; }
    .container { max-width:480px; margin:0 auto; background:white; border-radius:16px; overflow:hidden; box-shadow:0 1px 3px rgba(0,0,0,0.2); }
    .header { background:var(--p); color:white; padding:12px; font-size:17px; text-align:center; position:relative; display:flex; align-items:center; justify-content:center; }
    .back-btn { position:absolute; left:12px; font-size:20px; cursor:pointer; }
    .logo { height:36px; margin-right:8px; border-radius:8px; }
    .content { padding:16px; display:none; min-height:calc(100vh - 120px); }
    .content.active { display:block; }
    .db-item { display:flex; align-items:center; gap:12px; padding:14px; background:var(--l); border-radius:12px; margin:8px 0; cursor:pointer; font-size:15px; }
    .db-item svg { width:28px; height:28px; fill:#5f6368; }
    .add-row { display:flex; gap:6px; margin:12px 0; align-items:center; flex-wrap:wrap; }
    .add-row input, .add-row select { padding:8px; border:1px solid #dadce0; border-radius:8px; font-size:13px; }
    .add-row input[type="text"] { flex:1; min-width:80px; }
    .add-row input[type="number"] { width:70px; }
    .add-row .btn-add { background:var(--g); color:white; width:36px; height:36px; border-radius:50%; font-weight:bold; font-size:16px; }
    .table { width:100%; border-collapse:collapse; font-size:13px; margin:10px 0; }
    .table th, .table td { border:1px solid #ddd; padding:6px 4px; text-align:center; }
    .table th { background:var(--o); color:white; font-size:12px; }
    .table input { width:100%; padding:4px; border:none; text-align:center; font-size:12px; }
    .btn { padding:8px 12px; border:none; border-radius:8px; font-weight:500; cursor:pointer; margin:4px 2px; font-size:13px; }
    .btn-o { background:var(--o); color:white; }
    .btn-g { background:var(--g); color:white; }
    .btn-b { background:var(--p); color:white; }
    .total { font-weight:bold; text-align:right; padding:10px; background:#e8f0fe; border-radius:8px; margin:12px 0; font-size:15px; }
    .nav-bottom { position:fixed; bottom:0; left:0; right:0; background:white; border-top:1px solid #ddd; display:flex; padding:6px; box-shadow:0 -2px 8px rgba(0,0,0,0.1); z-index:100; }
    .nav-btn { flex:1; text-align:center; padding:10px; color:#5f6368; font-size:11px; cursor:pointer; }
    .nav-btn.active { color:var(--o); font-weight:bold; }
    .select-prod { display:flex; gap:6px; margin:12px 0; padding:8px; background:#f0f0f0; border-radius:8px; }
    .select-prod select { flex:1; }
    .select-prod input { width:60px; }
    .select-prod .btn-add { width:36px; height:36px; }
    .form-input { width:100%; padding:10px; margin:6px 0; border:1px solid #ddd; border-radius:8px; }
    .settings { padding:16px; }
    .logo-preview { width:80px; height:80px; border-radius:12px; object-fit:contain; background:#eee; margin:10px 0; }
    .cotiz-item { padding:12px; background:#f0f0f0; border-radius:8px; margin:8px 0; cursor:pointer; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <span class="back-btn" onclick="showSection('db')">Back</span>
    <img id="headerLogo" class="logo" src="" alt="" style="display:none;">
    <span id="pageTitle">Bases</span>
  </div>

  <!-- Bases -->
  <div class="content active" id="dbContent">
    <div class="db-item" onclick="showSection('mano')">
      <svg><use href="#mano"></use></svg>
      <div><strong>Mano de Obra</strong><br><small>Mano de obra calificada.</small></div>
    </div>
    <div class="db-item" onclick="showSection('equipos')">
      <svg><use href="#equipo"></use></svg>
      <div><strong>Equipos</strong><br><small>Equipos y herramientas.</small></div>
    </div>
    <div class="db-item" onclick="showSection('materiales')">
      <svg><use href="#material"></use></svg>
      <div><strong>Materiales</strong><br><small>Materiales de construcción.</small></div>
    </div>
    <div class="db-item" onclick="showSection('ajustes')">
      <svg><use href="#settings"></use></svg>
      <div><strong>Ajustes</strong><br><small>Logo, empresa, etc.</small></div>
    </div>
  </div>

  <!-- Ajustes -->
  <div class="content" id="ajustesContent">
    <h3>Ajustes</h3>
    <div class="settings">
      <label>Nombre de la Empresa:</label>
      <input type="text" id="empresaName" class="form-input" placeholder="Mi Empresa" />
      <label>Logo (200x200):</label>
      <input type="file" id="logoInput" accept="image/*" />
      <img id="logoPreview" class="logo-preview" src="" alt="" style="display:none;" />
      <button class="btn btn-g" onclick="saveSettings()">Guardar</button>
    </div>
  </div>

  <!-- Mano de Obra -->
  <div class="content" id="manoContent">
    <h3>Mano de Obra</h3>
    <div class="add-row">
      <input type="text" id="manoStock" placeholder="N/A" style="width:60px;" />
      <input type="text" id="manoDesc" placeholder="Puesto" />
      <input type="number" step="0.01" id="manoLista" placeholder="Lista" />
      <input type="number" step="0.01" id="manoPublico" placeholder="Público" />
      <button class="btn-add" onclick="addItem('mano')">+</button>
    </div>
    <table class="table">
      <thead><tr><th>Stock</th><th>Puesto</th><th>Lista</th><th>Público</th><th></th></tr></thead>
      <tbody id="manoList"></tbody>
    </table>
    <button class="btn btn-o" onclick="saveBase('mano')">Guardar</button>
  </div>

  <!-- Equipos -->
  <div class="content" id="equiposContent">
    <h3>Equipos</h3>
    <div class="add-row">
      <input type="text" id="equipoStock" placeholder="N/A" style="width:60px;" />
      <input type="text" id="equipoDesc" placeholder="Descripción" />
      <input type="number" step="0.01" id="equipoLista" placeholder="Lista" />
      <input type="number" step="0.01" id="equipoPublico" placeholder="Público" />
      <button class="btn-add" onclick="addItem('equipos')">+</button>
    </div>
    <table class="table">
      <thead><tr><th>Stock</th><th>Descripción</th><th>Lista</th><th>Público</th><th></th></tr></thead>
      <tbody id="equiposList"></tbody>
    </table>
    <button class="btn btn-o" onclick="saveBase('equipos')">Guardar</button>
  </div>

  <!-- Materiales -->
  <div class="content" id="materialesContent">
    <h3>Materiales</h3>
    <div class="add-row">
      <input type="text" id="matStock" placeholder="Stock" style="width:60px;" />
      <input type="text" id="matMarca" placeholder="Marca" />
      <input type="text" id="matDesc" placeholder="Descripción" />
      <input type="number" step="0.01" id="matLista" placeholder="Lista" />
      <input type="number" step="0.01" id="matPublico" placeholder="Público" />
      <button class="btn-add" onclick="addItem('materiales')">+</button>
    </div>
    <table class="table">
      <thead><tr><th>Stock</th><th>Marca</th><th>Descripción</th><th>Lista</th><th>Público</th><th></th></tr></thead>
      <tbody id="materialesList"></tbody>
    </table>
    <button class="btn btn-o" onclick="saveBase('materiales')">Guardar</button>
  </div>

  <!-- Cotización -->
  <div class="content" id="cotizContent">
    <div style="background:var(--o); color:white; padding:10px; margin:-16px -16px 16px; border-radius:16px 16px 0 0; font-weight:600;">
      Cotización No: <span id="cotizNum">000001</span>
    </div>
    <div style="display:flex; gap:6px; margin-bottom:12px;">
      <button class="btn btn-o" onclick="abrirListaCotizaciones()">Abrir</button>
      <button class="btn btn-g" onclick="nuevaVenta()">Nueva</button>
    </div>
    <input type="text" id="clienteName" placeholder="Cliente" class="form-input" />
    <input type="text" id="clienteTel" placeholder="Teléfono" class="form-input" />
    <input type="text" id="clienteDir" placeholder="Domicilio" class="form-input" />
    <textarea id="observaciones" placeholder="Observaciones" rows="2" class="form-input"></textarea>

    <div class="select-prod">
      <select id="selectProducto"><option>Seleccione...</option></select>
      <input type="number" id="cantAdd" placeholder="Cant" />
      <button class="btn-add" onclick="addToCotizFromSelect()">+</button>
    </div>

    <table class="table">
      <thead><tr><th>Cant</th><th>Producto</th><th>P.Púb</th><th>Total</th><th></th></tr></thead>
      <tbody id="cotizTable"></tbody>
    </table>
    <div class="total">Total: S/ <span id="cotizTotal">0.00</span></div>
    <div style="display:flex; gap:6px; flex-wrap:wrap;">
      <button class="btn btn-o" onclick="guardarCotizacion()">Guardar</button>
      <button class="btn btn-g" onclick="cobrar()">Cobrar</button>
      <button class="btn btn-b" onclick="imprimirPDF()">Guardar PDF</button>
      <button class="btn btn-g" onclick="enviarCotizacion()">Enviar</button>
    </div>
  </div>

  <!-- Lista de Cotizaciones -->
  <div class="content" id="listaCotizContent">
    <h3>Cotizaciones Guardadas</h3>
    <div id="listaCotiz"></div>
    <button class="btn btn-g" onclick="showSection('cotiz')">Volver</button>
  </div>
</div>

<div class="nav-bottom">
  <div class="nav-btn active" onclick="showSection('db')">Bases</div>
  <div class="nav-btn" onclick="showSection('cotiz')">$ Cotización</div>
</div>

<svg style="display:none;">
  <symbol id="mano" viewBox="0 0 24 24"><path d="M12 6v4h-1V6h1zm-1 6v6h1v-6h-1zm2-6h1v4h-1V6zm-2 6h1v6h-1v-6zm2 0h1v6h-1v-6z"/></symbol>
  <symbol id="equipo" viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></symbol>
  <symbol id="material" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4